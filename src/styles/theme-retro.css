/* =========================
   THEME: RETRO 
   ========================= */

/* Fonts */
/* Fonts */
@import url("https://fonts.googleapis.com/css2?family=Sora:wght@500;600;700;800&family=Space+Grotesk:wght@400;600;700&display=swap");

/* ---------- Vars ---------- */
:root[data-scheme="retro"],
[data-scheme="retro"] {
  --retro-bg: #131316;
  --retro-panel: #1d1e22;
  --retro-border: #3a3a3f;
  --retro-gloss: rgba(255,255,255,.08);
  --retro-text: #f6f6f6;
  --retro-muted: #a9a9b0;

  --retro-a1: #EF476F; /* magenta */
  --retro-a2: #FFD166; /* yellow */
  --retro-a3: #06D6A0; /* green */
  --retro-a4: #118AB2; /* cyan-blue */

  --theme-metal-top: #2b2c31;
  --theme-metal-bot: #1f2024;
  --theme-frame: #2f2f35;
  --theme-gloss: rgba(255,255,255,.08);

  --glow-on: #ff8a00;         /* active orange */
  --glow-on-strong: #ff6a00;

  --radius: 12px;
  --tap: 44px;
}

/* Base ~390px wide phone (iPhone 12/13-ish) */
:root[data-scheme="retro"] {
    --ui-scale: clamp(0.90, calc(100vi / 390), 1.12);  /* 320–438px phones */
    --tap: calc(44px * var(--ui-scale));               /* was fixed 44px */
    --radius: calc(12px * var(--ui-scale));
    --font-ctrl: calc(12px * var(--ui-scale));
    --font-small: calc(11px * var(--ui-scale));
  }

/* Background hint when retro */
:root[data-scheme="retro"] body,
[data-scheme="retro"] body {
  background: radial-gradient(1200px 700px at 20% -10%, #1a1b20 0%, #111115 60%, #0c0c0f 100%) fixed;
  color: var(--retro-text);
}

/* ---------- Panel ---------- */
:root[data-scheme="retro"] .gb-retro-panel,
[data-scheme="retro"] .gb-retro-panel {
  display: grid;
  gap: 14px;
  padding: 16px;
  background: linear-gradient(180deg, var(--retro-panel) 0%, #17181b 100%);
  border: 1px solid var(--retro-border);
  border-radius: 14px;
  box-shadow:
    0 12px 30px rgba(0,0,0,.45),
    inset 0 1px 0 var(--retro-gloss),
    inset 0 -1px 0 rgba(0,0,0,.4);
}

/* ---------- Header: wordmark + theme buttons ---------- */
:root[data-scheme="retro"] .gb-retro-header,
[data-scheme="retro"] .gb-retro-header {
  display:flex; align-items:center; gap:12px; padding-bottom:8px;
  
}

:root[data-scheme="retro"] .gb-theme-switch,
[data-scheme="retro"] .gb-theme-switch {
  margin-left: auto;           /* push buttons to the right */
  display: inline-flex;
  gap: 8px;
}

:root[data-scheme="retro"] .gb-wordmark,
[data-scheme="retro"] .gb-wordmark {
  font-family: "Russo One", "Orbitron", "Audiowide", var(--font-ui);
  font-weight: 800;
  font-size: clamp(32px, 9.0vw, 68px);
  line-height: 1;
  letter-spacing: 1px;
  margin: 0;
  white-space: nowrap;

  /* Colorful seamless loop */
  background: linear-gradient(90deg, #EF476F, #FFD166, #06D6A0, #118AB2, #EF476F);
  background-size: 240% 100%;
  background-position: 0% 50%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;

  animation:
    gbHueCycle 14s linear infinite,          /* perfect color loop */
    gbDrift    10s ease-in-out infinite alternate; /* smooth left↔right */
  will-change: filter, background-position;
}


@keyframes gbHueCycle { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
@keyframes gbDrift    { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

/* Theme buttons (small, edgy) */
:root[data-scheme="retro"] .gb-theme-btn,
[data-scheme="retro"] .gb-theme-btn {
  min-width: 70px;
  height: 30px;
  padding: 0 12px;
  border-radius: 4px;
  border: 1px solid var(--theme-frame);
  cursor: pointer;

  font: 900 11px/1 var(--font-ui);
  letter-spacing: .1em;

  color: #ececf1;
  background: linear-gradient(180deg, var(--theme-metal-top), var(--theme-metal-bot));
  box-shadow: 0 3px 0 rgba(0,0,0,.5), inset 0 1px 0 var(--theme-gloss);
  transition: filter .15s, transform .05s, box-shadow .2s, background .2s, color .2s;
}
:root[data-scheme="retro"] .gb-theme-btn:hover,
[data-scheme="retro"] .gb-theme-btn:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .gb-theme-btn:active,
[data-scheme="retro"] .gb-theme-btn:active {
  transform: translateY(1px);
  box-shadow: 0 1px 0 rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.06);
}
:root[data-scheme="retro"] .gb-theme-btn.is-active,
[data-scheme="retro"] .gb-theme-btn.is-active {
  color: #1b0e00;
  border-color: rgba(255,138,0,.75);
  background: linear-gradient(180deg, var(--glow-on) 0%, var(--glow-on-strong) 100%);
  box-shadow:
    0 0 14px rgba(255,140,0,.45),
    0 0 26px rgba(255,140,0,.25),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* ---------- Rows (hardware strips) ---------- */
:root[data-scheme="retro"] .gb-row,
[data-scheme="retro"] .gb-row {
  position: relative;
  padding: 12px;
  border: 1px solid var(--retro-border);
  border-radius: 10px;
  background: linear-gradient(180deg, #232429 0%, #1a1b20 100%);
  box-shadow:
    inset 0 1px 0 var(--retro-gloss),
    inset 0 -1px 0 rgba(0,0,0,.5),
    0 8px 16px rgba(0,0,0,.25);
}

/* Remove any old chip labels that may linger */
:root[data-scheme="retro"] .gb-row--packs::before,
:root[data-scheme="retro"] .gb-row--session::before,
[data-scheme="retro"] .gb-row--packs::before,
[data-scheme="retro"] .gb-row--session::before { content: none !important; }

/* ---------- Universal control typography ---------- */
:root[data-scheme="retro"] .gb-retro-panel select,
:root[data-scheme="retro"] .gb-retro-panel button,
:root[data-scheme="retro"] .gb-retro-panel input[type="number"],
:root[data-scheme="retro"] .gb-retro-panel input[type="text"],
[data-scheme="retro"] .gb-retro-panel select,
[data-scheme="retro"] .gb-retro-panel button,
[data-scheme="retro"] .gb-retro-panel input[type="number"],
[data-scheme="retro"] .gb-retro-panel input[type="text"] {
  font-family: "Orbitron", var(--font-ui);
  font-weight: 700;
  letter-spacing: .04em;
}

/* Focus ring */
:root[data-scheme="retro"] .gb-retro-panel select:focus-visible,
:root[data-scheme="retro"] .gb-retro-panel button:focus-visible,
:root[data-scheme="retro"] .gb-retro-panel input[type="number"]:focus-visible,
:root[data-scheme="retro"] .gb-retro-panel input[type="text"]:focus-visible,
:root[data-scheme="retro"] .gb-retro-panel input[type="range"]:focus-visible,
[data-scheme="retro"] .gb-retro-panel select:focus-visible,
[data-scheme="retro"] .gb-retro-panel button:focus-visible,
[data-scheme="retro"] .gb-retro-panel input[type="number"]:focus-visible,
[data-scheme="retro"] .gb-retro-panel input[type="text"]:focus-visible,
[data-scheme="retro"] .gb-retro-panel input[type="range"]:focus-visible {
  outline: 2px solid var(--retro-a2);
  outline-offset: 2px;
  box-shadow: 0 0 0 3px rgba(255, 209, 102, .18);
}

/* Disabled */
:root[data-scheme="retro"] .gb-retro-panel :disabled,
[data-scheme="retro"] .gb-retro-panel :disabled {
  opacity: .55;
  cursor: not-allowed;
  filter: grayscale(.15);
}

/* ---------- Buttons: oldschool drumcomputer (base) ---------- */
:root[data-scheme="retro"] .btn-retro,
:root[data-scheme="retro"] .gb-retro-panel button:not(.gb-theme-btn),
[data-scheme="retro"] .btn-retro,
[data-scheme="retro"] .gb-retro-panel button:not(.gb-theme-btn) {
  min-height: var(--tap);
  padding: 0 14px;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
}
:root[data-scheme="retro"] .gb-retro-panel button:hover,
[data-scheme="retro"] .gb-retro-panel button:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .gb-retro-panel button:active,
[data-scheme="retro"] .gb-retro-panel button:active {
  transform: translateY(1px);
  box-shadow: 0 1px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
}
/* Accent variants (optional via className) */
:root[data-scheme="retro"] .btn--accent-red,
[data-scheme="retro"] .btn--accent-red    { background: linear-gradient(180deg, #ef476f, #b83a59); color:#fff; }
:root[data-scheme="retro"] .btn--accent-yellow,
[data-scheme="retro"] .btn--accent-yellow { background: linear-gradient(180deg, #ffd166, #ccac53); color:#1b1b1b; }
:root[data-scheme="retro"] .btn--accent-green,
[data-scheme="retro"] .btn--accent-green  { background: linear-gradient(180deg, #06d6a0, #059e77); color:#02130e; }

/* ---------- Selects & Inputs (shared) ---------- */
:root[data-scheme="retro"] .gb-retro-panel select,
[data-scheme="retro"] .gb-retro-panel select {
  min-height: var(--tap);
  padding: 0 12px;
  color: var(--retro-text);
  background: linear-gradient(180deg, #2b2c31 0%, #1f2024 100%);
  border: 1px solid #2f2f35;
  border-radius: 6px;
  box-shadow: inset 0 1px 0 var(--retro-gloss), inset 0 -1px 0 rgba(0,0,0,.5);
}
:root[data-scheme="retro"] .gb-retro-panel input[type="number"],
:root[data-scheme="retro"] .gb-retro-panel input[type="text"],
[data-scheme="retro"] .gb-retro-panel input[type="number"],
[data-scheme="retro"] .gb-retro-panel input[type="text"] {
  min-height: var(--tap);
  padding: 0 10px;
  color: var(--retro-text);
  background: linear-gradient(180deg, #2b2c31, #1f2024);
  border: 1px solid #2f2f35;
  border-radius: 6px;
  box-shadow: inset 0 1px 0 var(--retro-gloss), inset 0 -1px 0 rgba(0,0,0,.5);
}

/* =======================================================
   PACKBAR — RETRO layout (inline label, 2 rows)
   Row 1: [Pack label] [Pack select] [Met]
   Row 2: [BPM label]  [BPM slider]  [BPM readout]
   ======================================================= */
:root[data-scheme="retro"] .packbar-retro,
[data-scheme="retro"] .packbar-retro {
  display: grid;
  gap: 12px;
}

/* Row 1: Pack + Met */
:root[data-scheme="retro"] .packbar-retro .packbar-line1,
[data-scheme="retro"] .packbar-retro .packbar-line1 {
  display: grid;
  grid-template-columns: auto minmax(220px, 1fr) auto; /* [label] [select] [met] */
  gap: 12px;
  align-items: center;
}
/* Inline "Pack" label */
:root[data-scheme="retro"] .packbar-retro .packbar-line1::before,
[data-scheme="retro"] .packbar-retro .packbar-line1::before {
  content: "Pack";
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .12em;
  color: #eaeaf0;
  opacity: .95;
}

/* Row 2: BPM on its own line */
:root[data-scheme="retro"] .packbar-retro .packbar-line2,
[data-scheme="retro"] .packbar-retro .packbar-line2 {
  display: grid;
  grid-template-columns: auto 1fr auto;     /* [BPM] [slider] [readout] */
  gap: 12px;
  align-items: center;
}
:root[data-scheme="retro"] .packbar-retro .bpm-label,
[data-scheme="retro"] .packbar-retro .bpm-label {
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .12em;
  opacity: .9;
}
:root[data-scheme="retro"] .packbar-retro .bpm-readout,
[data-scheme="retro"] .packbar-retro .bpm-readout {
  min-width: 52px;
  text-align: right;
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .06em;
  color: #f2f2f2;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #2f2f35;
  background: linear-gradient(180deg, #2b2c31, #1f2024);
  box-shadow: inset 0 1px 0 var(--retro-gloss);
}

/* Pack select style (Session uses the same) */
:root[data-scheme="retro"] .packbar-retro select,
[data-scheme="retro"] .packbar-retro select {
  min-height: var(--tap);
  padding: 0 12px;
  color: var(--retro-text);
  background: linear-gradient(180deg, #2b2c31 0%, #1f2024 100%);
  border: 1px solid #2f2f35;
  border-radius: 6px;
  box-shadow: inset 0 1px 0 var(--retro-gloss), inset 0 -1px 0 rgba(0,0,0,.5);
}

/* =======================================================
   SESSION — same dropdown look, buttons on row 2
   Layout: 2-row grid. Row 1 = [Session label] [select].
           Row 2 = all buttons (auto-wrapping).
   ======================================================= */
:root[data-scheme="retro"] .gb-row--session > *,
[data-scheme="retro"] .gb-row--session > * {
  display: grid;
  grid-template-columns: auto minmax(220px, 1fr); /* row 1 columns */
  align-items: center;
  column-gap: 10px;
  row-gap: 10px;
  grid-auto-rows: auto;
}

/* SESSION — inline label + select on row 1, buttons wrap on row 2 (no overflow) */
:root[data-scheme="retro"] .gb-row--session > *,
[data-scheme="retro"] .gb-row--session > * {
  display: flex !important;          /* override any old grid */
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;                    /* allow wrapping to new lines */
  max-width: 100%;
  min-width: 0;                       /* prevent content from forcing overflow */
}

/* Inline "Session" label (same style as "Pack") */
:root[data-scheme="retro"] .gb-row--session > *::before,
[data-scheme="retro"] .gb-row--session > *::before {
  content: "Session";
  order: 0;
  flex: 0 0 auto;
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .12em;
  color: #eaeaf0;
  opacity: .95;
}

/* Force a line break after label + select so buttons start on the next row */
:root[data-scheme="retro"] .gb-row--session > *::after,
[data-scheme="retro"] .gb-row--session > *::after {
  content: "";
  order: 1;
  flex: 0 0 100%;                     /* acts as a line breaker */
}

/* Session select: same look as Pack; stays on row 1 */
:root[data-scheme="retro"] .gb-row--session > * select:first-of-type,
[data-scheme="retro"] .gb-row--session > * select:first-of-type {
  order: 0;
  flex: 1 1 auto;                     /* fills remaining space on row 1 */
  min-width: 220px;
  width: auto;
  min-height: var(--tap);
  padding: 0 12px;
  color: var(--retro-text);
  background: linear-gradient(180deg, #2b2c31 0%, #1f2024 100%);
  border: 1px solid #2f2f35;
  border-radius: 6px;
  box-shadow: inset 0 1px 0 var(--retro-gloss), inset 0 -1px 0 rgba(0,0,0,.5);
  max-width: 100%;
}

/* All non-select controls (buttons, label.btn for Import) live on row 2 and wrap */
:root[data-scheme="retro"] .gb-row--session > * > :not(select),
[data-scheme="retro"] .gb-row--session > * > :not(select) {
  order: 2;
  flex: 0 1 auto;                     /* shrink if needed, then wrap */
  max-width: 100%;
}

/* Retro button finish for Session row controls */
:root[data-scheme="retro"] .gb-row--session > * :where(button, .btn),
[data-scheme="retro"] .gb-row--session > * :where(button, .btn) {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  min-height: 38px;
  padding: 0 12px;
  border-radius: 3px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 11px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  white-space: nowrap;                /* keeps labels tidy; wrapped by flex, not inside */
  transition: transform .05s, filter .15s, box-shadow .2s;
}
:root[data-scheme="retro"] .gb-row--session > * :where(button, .btn):hover,
[data-scheme="retro"] .gb-row--session > * :where(button, .btn):hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .gb-row--session > * :where(button, .btn):active,
[data-scheme="retro"] .gb-row--session > * :where(button, .btn):active {
  transform: translateY(1px);
  box-shadow: 0 1px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
}

/* Phone tweaks */
@media (max-width: 640px) {
  :root[data-scheme="retro"] .gb-row--session > *,
  [data-scheme="retro"] .gb-row--session > * {
    gap: 8px;
  }
  :root[data-scheme="retro"] .gb-row--session > * select:first-of-type,
  [data-scheme="retro"] .gb-row--session > * select:first-of-type {
    min-width: 0;                      /* allow tighter phones */
    flex: 1 1 60%;
  }
  :root[data-scheme="retro"] .gb-row--session > * :where(button, .btn),
  [data-scheme="retro"] .gb-row--session > * :where(button, .btn) {
    min-height: 36px;
    padding: 0 10px;
    font-weight: 700;
  }
}



/* RETRO Session — reset the earlier pseudo label/breaker */
:root[data-scheme="retro"] .gb-row--session > *::before,
:root[data-scheme="retro"] .gb-row--session > *::after{
  content: none !important;
}

/* use the REAL label from JSX */
:root[data-scheme="retro"] .gb-row--session .bar-label{
  display: inline !important;
  font: 800 12px/1 "Orbitron"
}

/* 2-row frame, compact vertical spacing */
:root[data-scheme="retro"] .gb-row--session .sessionbar-neo{
  display: grid;
  grid-template-rows: auto auto;
  row-gap: 8px;     /* tighter than before */
  width: 100%;
}

/* Row 1 = [Label][Select] */
:root[data-scheme="retro"] .gb-row--session .session-row--top{
  display: grid;
  grid-template-columns: auto minmax(220px, 1fr);
  align-items: center;
  column-gap: 10px;
}

:root[data-scheme="retro"] .gb-row--session .session-row--top .session-select{
  min-width: 0;     /* prevents overflow on narrow widths */
}

/* Row 2 = buttons, spread across the row */
:root[data-scheme="retro"] .gb-row--session .session-row--buttons{
  display: flex;
  align-items: center;
  justify-content: space-between;  /* ⬅ spreads the group */
  gap: 4px;
  flex-wrap: wrap;                 /* wrap if it gets tight */
  width: 100%;                     /* span full row */
}

/* Center button contents (incl. <label class="btn">Import) */
:root[data-scheme="retro"] .gb-row--session .session-row--buttons :where(button, .btn){
  display: flex;
  align-items: center;
  justify-content: center;
  height: 34px;
  padding: 0 12px;
  line-height: 1;
  flex: 0 1 auto;                  /* don't stretch; spacing handles spread */
}

/* Small screens: left-align + scroll if necessary */
@media (max-width: 560px){
  :root[data-scheme="retro"] .gb-row--session .session-row--buttons{
    justify-content: flex-start;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}


/* RETRO Session — match Packbar label + center buttons */

/* kill any previously injected pseudo label/break */
:root[data-scheme="retro"] .gb-row--session > *::before,
:root[data-scheme="retro"] .gb-row--session > *::after{
  content: none !important;
}

/* Row 1 = [label][select] — same grid as Packbar */
:root[data-scheme="retro"] .gb-row--session .session-row--top{
  display: grid;
  grid-template-columns: auto minmax(220px, 1fr);
  gap: 12px;
  align-items: center;
}

/* Label styled like Packbar label (Orbitron, uppercase feel) */
:root[data-scheme="retro"] .gb-row--session .session-row--top .bar-label{
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .12em;
  color: #eaeaf0;
  opacity: .95;
  margin: 0;
  white-space: nowrap;
}

/* Let the select shrink on tight widths */
:root[data-scheme="retro"] .gb-row--session .session-row--top .session-select{
  min-width: 0;
}

/* Row 2 = buttons, centered within the frame */
:root[data-scheme="retro"] .gb-row--session .session-row--buttons{
  display: flex;
  justify-content: center;   /* ⬅ center the whole cluster */
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;           /* wrap if needed */
  width: 100%;
}

/* Button internals centered (includes <label class="btn">Import) */
:root[data-scheme="retro"] .gb-row--session .session-row--buttons :where(button, .btn){
  display: flex;
  align-items: center;
  justify-content: center;
  height: 34px;
  padding: 0 12px;
  line-height: 1;
  flex: 0 1 auto;            /* don't stretch; just wrap */
}

/* Narrow screens: left align to allow natural horizontal scroll */
@media (max-width: 560px){
  :root[data-scheme="retro"] .gb-row--session .session-row--buttons{
    justify-content: flex-start;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}


/* =======================================================
   METRONOME (3 states)
   ======================================================= */
:root[data-scheme="retro"] .metro-btn,
[data-scheme="retro"] .metro-btn {
  min-width: 112px;
  border-radius: 4px;
  font-weight: 800;
  letter-spacing: .04em;
  transition: background .15s ease, box-shadow .2s ease, color .15s ease, transform .05s ease, filter .15s ease;
}
:root[data-scheme="retro"] .metro-btn:hover,
[data-scheme="retro"] .metro-btn:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .metro-btn:active,
[data-scheme="retro"] .metro-btn:active { transform: translateY(1px); }

/* Met 16 — cyan glow */
:root[data-scheme="retro"] .metro-btn.mode-all,
[data-scheme="retro"] .metro-btn.mode-all {
  background: linear-gradient(180deg, var(--retro-a4) 0%, #0e7da2 100%);
  color:#fff;
  box-shadow:
    0 3px 10px rgba(17,138,178,.45),
    0 0 24px rgba(17,138,178,.35),
    inset 0 1px 0 rgba(255,255,255,.25);
}

/* Met 4 — warm glow */
:root[data-scheme="retro"] .metro-btn.mode-beats,
[data-scheme="retro"] .metro-btn.mode-beats {
  background: linear-gradient(180deg, #ffb34a 0%, #ff9800 100%);
  color:#1b0e00;
  text-shadow: 0 1px 0 rgba(255,255,255,.25);
  box-shadow:
    0 3px 10px rgba(255,152,0,.45),
    0 0 24px rgba(255,152,0,.30),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* Off — muted */
:root[data-scheme="retro"] .metro-btn.mode-off,
[data-scheme="retro"] .metro-btn.mode-off {
  background: linear-gradient(180deg, #2c2c2f 0%, #1f1f22 100%);
  color:#aaa;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
}

/* =======================================================
   BPM SLIDER
   ======================================================= */
:root[data-scheme="retro"] .slider-bpm,
[data-scheme="retro"] .slider-bpm { height: 44px; }

/* track */
:root[data-scheme="retro"] .slider-bpm::-webkit-slider-runnable-track { height: 8px; background: linear-gradient(180deg, #3b3b3b, #2b2b2b); border-radius: 4px; box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.3); }
:root[data-scheme="retro"] .slider-bpm::-moz-range-track        { height: 8px; background: linear-gradient(180deg, #3b3b3b, #2b2b2b); border-radius: 4px; box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.3); }

/* thumb */
:root[data-scheme="retro"] .slider-bpm::-webkit-slider-thumb{
  -webkit-appearance:none; width:14px;height:28px;margin-top:-10px;border-radius:3px;
  border:1px solid rgba(0,0,0,.6);
  background:
    linear-gradient(180deg,#f7f7f7 0%,#e8e8e8 60%,#d6d6d6 100%),
    linear-gradient(90deg,transparent 45%,rgba(0,0,0,.25) 47%,rgba(0,0,0,.25) 53%,transparent 55%);
  box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
  transition: box-shadow .2s, transform .05s, filter .15s;
}
:root[data-scheme="retro"] .slider-bpm::-webkit-slider-thumb:active{
  transform: translateY(1px);
  box-shadow:0 1px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.55), 0 0 10px rgba(37,99,235,.35);
}
:root[data-scheme="retro"] .slider-bpm::-moz-range-thumb{
  width:14px;height:28px;border-radius:3px;border:1px solid rgba(0,0,0,.6);
  background:
    linear-gradient(180deg,#f7f7f7 0%,#e8e8e8 60%,#d6d6d6 100%),
    linear-gradient(90deg,transparent 45%,rgba(0,0,0,.25) 47%,rgba(0,0,0,.25) 53%,transparent 55%);
  box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);

/* =======================================================
   Responsive
   ======================================================= */
@media (max-width: 640px) {
  :root[data-scheme="retro"] .gb-wordmark,
  [data-scheme="retro"] .gb-wordmark { font-size: clamp(28px, 8vw, 40px); }

  :root[data-scheme="retro"] .gb-theme-btn,
  [data-scheme="retro"] .gb-theme-btn { min-width: 64px; height: 28px; font-weight: 800; }

  /* PackBar rows keep structure; just let columns flex */
  :root[data-scheme="retro"] .packbar-retro .packbar-line1,
  [data-scheme="retro"] .packbar-retro .packbar-line1 { grid-template-columns: auto 1fr auto; }

  :root[data-scheme="retro"] .packbar-retro .packbar-line2,
  [data-scheme="retro"] .packbar-retro .packbar-line2 { grid-template-columns: auto 1fr auto; }

  /* Session: label removed; select full-width on row 1; buttons wrap below */
  :root[data-scheme="retro"] .gb-row--session > *,
  [data-scheme="retro"] .gb-row--session > * { gap: 8px; }
}
}


/* ===== Subtle tinted panels for Packbar & Session ===== */
:root[data-scheme="retro"] {
    /* tweak alphas to taste */
    --pack-tint-1: rgba(17,138,178,.10);  /* cyan-blue glow */
    --pack-tint-2: rgba(17,138,178,.06);
  
    --sess-tint-1: rgba(239,71,111,.10);  /* magenta glow */
    --sess-tint-2: rgba(239,71,111,.06);
  }
  
  /* Packbar tint */
  :root[data-scheme="retro"] .gb-row--packs,
  [data-scheme="retro"] .gb-row--packs {
    /* layer a soft color wash over your existing panel gradient */
    background:
      radial-gradient(140% 180% at 0% -20%, var(--pack-tint-1), transparent 60%),
      linear-gradient(90deg, var(--pack-tint-2), transparent 60%),
      linear-gradient(180deg, #232429 0%, #1a1b20 100%);
    border-color: rgba(17,138,178,.22);
    box-shadow:
      inset 0 1px 0 var(--retro-gloss),
      inset 0 -1px 0 rgba(0,0,0,.5),
      0 8px 16px rgba(0,0,0,.25),
      0 0 0 1px rgba(17,138,178,.08);
  }
  :root[data-scheme="retro"] .gb-row--packs:hover,
  [data-scheme="retro"] .gb-row--packs:hover {
    background:
      radial-gradient(140% 180% at 0% -20%, rgba(17,138,178,.12), transparent 60%),
      linear-gradient(90deg, rgba(17,138,178,.08), transparent 60%),
      linear-gradient(180deg, #232429 0%, #1a1b20 100%);
  }
  
  /* Session tint */
  :root[data-scheme="retro"] .gb-row--session,
  [data-scheme="retro"] .gb-row--session {
    background:
      radial-gradient(140% 180% at 100% -20%, var(--sess-tint-1), transparent 60%),
      linear-gradient(270deg, var(--sess-tint-2), transparent 60%),
      linear-gradient(180deg, #232429 0%, #1a1b20 100%);
    border-color: rgba(239,71,111,.22);
    box-shadow:
      inset 0 1px 0 var(--retro-gloss),
      inset 0 -1px 0 rgba(0,0,0,.5),
      0 8px 16px rgba(0,0,0,.25),
      0 0 0 1px rgba(239,71,111,.08);
  }
  :root[data-scheme="retro"] .gb-row--session:hover,
  [data-scheme="retro"] .gb-row--session:hover {
    background:
      radial-gradient(140% 180% at 100% -20%, rgba(239,71,111,.12), transparent 60%),
      linear-gradient(270deg, rgba(239,71,111,.08), transparent 60%),
      linear-gradient(180deg, #232429 0%, #1a1b20 100%);
  }


  
  /* ===== Pack row mobile fit ===== */
@media (max-width: 640px) {
    /* Grid: [Pack label] [select flexes] [Met button fits content] */
    :root[data-scheme="retro"] .packbar-retro .packbar-line1,
    [data-scheme="retro"] .packbar-retro .packbar-line1 {
      grid-template-columns: auto minmax(0, 1fr) max-content;
      align-items: center;
    }
  
    /* Let the native select actually shrink inside CSS Grid */
    :root[data-scheme="retro"] .packbar-retro .packbar-line1 select,
    [data-scheme="retro"] .packbar-retro .packbar-line1 select {
      min-width: 0;               /* crucial for grid shrinking */
      width: 100%;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;     /* long pack names won't push layout */
      white-space: nowrap;
    }
  
    /* Keep the Metronome button from demanding too much width */
    :root[data-scheme="retro"] .metro-btn,
    [data-scheme="retro"] .metro-btn {
      min-width: 104px;            /* was 112px; a touch leaner on phones */
      padding: 0 10px;
      flex: 0 0 auto;
    }
  }

  /* ===== BPM row elasticity ===== */
@media (max-width: 640px) {
    /* Grid stays [label][slider][readout], but allow slider cell to shrink */
    :root[data-scheme="retro"] .packbar-retro .packbar-line2,
    [data-scheme="retro"] .packbar-retro .packbar-line2 {
      grid-template-columns: auto minmax(0, 1fr) max-content;
      align-items: center;
      column-gap: 12px;
    }
  
    /* Ensure the slider itself can shrink in its grid cell */
    :root[data-scheme="retro"] .packbar-retro .packbar-line2 input[type="range"].slider-bpm,
    [data-scheme="retro"] .packbar-retro .packbar-line2 input[type="range"].slider-bpm {
      min-width: 0;     /* the magic for Grid children */
      width: 100%;
    }
  
    /* Keep the numeric readout compact and non-wrapping */
    :root[data-scheme="retro"] .packbar-retro .bpm-readout,
    [data-scheme="retro"] .packbar-retro .bpm-readout {
      white-space: nowrap;
      flex: 0 0 auto;
    }
  }

  

  /* ===== Session buttons: 2 rows × 3 on phones ===== */
@media (max-width: 640px) {
    :root[data-scheme="retro"] .gb-row--session .session-row--buttons,
    [data-scheme="retro"] .gb-row--session .session-row--buttons {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;                     /* even spacing in both directions */
      justify-items: stretch;       /* each button spans full cell width */
      align-items: stretch;
    }
  
    /* Make each control fill its grid cell cleanly */
    :root[data-scheme="retro"] .gb-row--session .session-row--buttons :where(button, .btn),
    [data-scheme="retro"] .gb-row--session .session-row--buttons :where(button, .btn) {
      width: 100%;
      min-width: 0;
      white-space: nowrap;          /* keep labels tidy; grid handles wrapping */
      height: 36px;
      padding: 0 10px;
      text-align: center;
    }
  }
  

  /* Make label-based buttons identical to real buttons */
:root[data-scheme="retro"] .session-row--buttons :where(button, label.btn),
[data-scheme="retro"] .session-row--buttons :where(button, label.btn) {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 36px;          /* match your mobile button height */
  padding: 0 12px;
  line-height: 1;
  white-space: nowrap;
  box-sizing: border-box;
  vertical-align: middle;
  min-width: 0;          /* allows shrinking in tight grids */
}

/* Properly hide the file input without layout side effects */
.visually-hidden-file {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0 0 0 0);
  white-space: nowrap; border: 0;
}



/* =========================
   Instruments — Retro finish
   ========================= */
   :root[data-scheme="retro"] .inst-btn,
   [data-scheme="retro"] .inst-btn {
     /* keep your nice dimensions */
     padding-top: 14px;
     padding-bottom: 14px;
     min-height: 20px;
     border-radius: 2px;
   
     /* retro slab */
     background: linear-gradient(180deg, #2f3035 0%, #232428 100%);
     border: 1px solid rgba(0,0,0,.6);
     color: #f4f4f4;
     box-shadow:
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.08);
   
     font-family: "Orbitron", var(--font-ui);
     font-weight: 800;
     letter-spacing: .04em;
     transition: filter .15s ease, transform .05s ease, box-shadow .2s ease, background .2s ease;
   }
   :root[data-scheme="retro"] .inst-btn:hover,
   [data-scheme="retro"] .inst-btn:hover { filter: brightness(1.06); }
   :root[data-scheme="retro"] .inst-btn:active,
   [data-scheme="retro"] .inst-btn:active { transform: translateY(1px); }
   
   /* subtle step indicator bar (lights up when selected) */
   :root[data-scheme="retro"] .inst-btn::after,
   [data-scheme="retro"] .inst-btn::after {
     content: "";
     display: block;
     height: 3px;
     margin-top: 8px;
     border-radius: 2px;
     background: linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
   }
   
   /* Selected instrument — warm retro-green glow */
   :root[data-scheme="retro"] .inst-btn.is-selected,
   [data-scheme="retro"] .inst-btn.is-selected {
     background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
     color: #071a12;
     text-shadow: 0 1px 0 rgba(255,255,255,.35);
     border-color: rgba(0,0,0,.55);
     box-shadow:
       0 0 16px rgba(6,214,160,.35),
       0 0 28px rgba(6,214,160,.22),
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.35);
   }
   :root[data-scheme="retro"] .inst-btn.is-selected::after,
   [data-scheme="retro"] .inst-btn.is-selected::after {
     background: linear-gradient(90deg, rgba(6,214,160,.85), rgba(6,214,160,.45));
   }
   
   /* Focus ring (keyboard) */
   :root[data-scheme="retro"] .inst-btn:focus-visible,
   [data-scheme="retro"] .inst-btn:focus-visible {
     outline: 2px solid var(--retro-a2);
     outline-offset: 2px;
     box-shadow: 0 0 0 3px rgba(255,209,102,.18), 0 3px 0 rgba(0,0,0,.45) inset;
   }
   
   /* ---- Mute buttons ---- */
   :root[data-scheme="retro"] .mute-btn,
   [data-scheme="retro"] .mute-btn {
     /* similar slab, slightly shorter than inst pads by default */
     min-height: 36px;
     padding: 0 12px;
     border-radius: 6px;
     border: 1px solid rgba(0,0,0,.6);
     background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
     color: #f4f4f4;
     box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
     font: 800 11px/1 "Orbitron", var(--font-ui);
     letter-spacing: .06em;
     transition: filter .15s, transform .05s, box-shadow .2s;
   }
   :root[data-scheme="retro"] .mute-btn:hover,
   [data-scheme="retro"] .mute-btn:hover { filter: brightness(1.06); }
   :root[data-scheme="retro"] .mute-btn:active,
   [data-scheme="retro"] .mute-btn:active { transform: translateY(1px); }
   
   /* Muted state — glowing red */
   :root[data-scheme="retro"] .mute-btn.is-muted,
   [data-scheme="retro"] .mute-btn.is-muted {
     background: linear-gradient(180deg, #ff6b6b 0%, #d33a3a 100%);
     color: #2a0a0a;
     text-shadow: 0 1px 0 rgba(255,255,255,.25);
     box-shadow:
       0 0 14px rgba(239,71,111,.4),
       0 0 26px rgba(239,71,111,.22),
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.35);
   }
   
   /* Make sure pads/buttons never overflow narrow screens */
   @media (max-width: 640px) {
     :root[data-scheme="retro"] .inst-btn,
     [data-scheme="retro"] .inst-btn { min-width: 0; }
     :root[data-scheme="retro"] .mute-btn,
     [data-scheme="retro"] .mute-btn { min-width: 0; }
   }
   

   /* =========================
   CHANNEL — PADS + FADER (RETRO) — consolidated
   ========================= */
/* Grid: [Pads] | [Fader + LCD + Solo] | [Vol/Pitch] */
[data-scheme="retro"] .channel-block.pads-left {
  /* sizing */
  --pad-size: clamp(58px, 30vw, 160px);
  --pad-gap: 10px;

  /* fader visuals */
  --track-th: 8px;    /* track thickness */
  --thumb-w: 16px;    /* thumb width  (pre-rotation) */
  --thumb-h: 26px;    /* thumb height (pre-rotation) */

  /* stack pieces */
  --lcd-h: 28px;
  --solo-h: 36px;
  --stack-gap: 8px;

  /* spacing between pads and fader */
  /* your original clamp collapsed to ~26px anyway, so make it stable */
  --extra-pad-fader-gap: 26px;

  /* derived */
  --stack-h: calc(var(--pad-size) * 2 + var(--pad-gap));
  --fader-h: max(140px,
                 calc(var(--stack-h) - var(--lcd-h) - var(--solo-h) - (var(--stack-gap) * 2)));
  --pads-col-w: calc(var(--pad-size) * 2 + var(--pad-gap));

  display: grid;
  grid-template-columns: var(--pads-col-w) auto auto;
  column-gap: var(--extra-pad-fader-gap);
  align-items: stretch;
}

/* ---------- PADS (2×2 exact squares) ---------- */
[data-scheme="retro"] .pads-2x2.tiny-gap {
  margin-left: var(--space-4);
  width: var(--pads-col-w);
  display: grid;
  grid-template-columns: repeat(2, var(--pad-size));
  grid-auto-rows: var(--pad-size);    /* height = width → perfect squares */
  gap: var(--pad-gap);
  justify-self: start;
}

/* Pad face (retro slab & LED bar) */
[data-scheme="retro"] .pad-btn {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background:
    radial-gradient(90% 70% at 50% 10%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, #303136 0%, #242529 100%);
  box-shadow:
    0 4px 10px rgba(0,0,0,.25),
    inset 0 0 0 1px rgba(255,255,255,.08),
    inset 0 2px 0 rgba(255,255,255,.06);
  transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
  position: relative;
  overflow: hidden;
}
[data-scheme="retro"] .pad-btn::before{
  content:"";
  position:absolute;
  inset: 0 0 60% 0;
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  pointer-events:none;
}
[data-scheme="retro"] .pad-btn::after{
  content:"";
  position:absolute;
  left:8px; right:8px; bottom:8px; height:4px;
  border-radius:3px;
  background: linear-gradient(90deg, rgba(6,214,160,.4), rgba(17,138,178,.35));
  box-shadow: 0 0 10px rgba(6,214,160,.25), 0 0 18px rgba(17,138,178,.2);
  opacity:.0;
  transition: opacity .15s ease, filter .15s ease;
}
[data-scheme="retro"] .pad-btn:hover{ filter: brightness(1.05); }
[data-scheme="retro"] .pad-btn:hover::after{ opacity:.35; }
[data-scheme="retro"] .pad-btn:active{
  transform: translateY(1px);
  box-shadow: 0 2px 6px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.05);
}
[data-scheme="retro"] .pad-btn:active::after{ opacity:.95; filter: saturate(1.2); }
[data-scheme="retro"] .pad-btn__inner{
  height: 100%; width: 100%;
  display: flex; align-items: center; justify-content: center;
  flex-direction: column; gap: 4px; user-select: none;
}
[data-scheme="retro"] .pad-btn__label{
  font: 800 18px/1 "Orbitron", var(--font-ui);
  letter-spacing: .04em; text-shadow: 0 1px 0 rgba(0,0,0,.6);
}
[data-scheme="retro"] .pad-btn__sub{
  font: 12px/1 var(--font-ui); color: #cfd2da; opacity: .8;
}

/* ---------- MIDDLE STACK (fader → LCD → Solo) ---------- */
[data-scheme="retro"] .vfader-wrap{
  display: grid;
  grid-template-rows: var(--fader-h) var(--lcd-h) var(--solo-h);
  row-gap: var(--stack-gap);
  align-items: center;
  justify-items: center;
}

/* Bezel/slot */
[data-scheme="retro"] .vfader-slot{
  position: relative;
  height: var(--fader-h);
  width: 30px;
  padding: 6px 4px;
  border-radius: 10px;
  background: linear-gradient(180deg, #2a2b30, #1f2024);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06), inset 0 -1px 0 rgba(0,0,0,.45);
  overflow: hidden;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Vertical fader (rotate, center, and size to slot) */
[data-scheme="retro"] .vfader{
  appearance: none; -webkit-appearance: none;
  background: transparent; outline: none; cursor: pointer;
  position: absolute; left: 50%; top: 50%;
  transform: translate(-50%, -50%) rotate(-90deg);
  transform-origin: 50% 50%;
  width: calc(var(--fader-h) - 12px);   /* slot height - padding */
  height: calc(var(--track-th) * 2);    /* control box thickness pre-rotation */
  margin: 0;
}
/* track */
[data-scheme="retro"] .vfader::-webkit-slider-runnable-track{ height: var(--track-th);
  background: linear-gradient(180deg, #3b3c41, #2b2c31);
  border-radius: 6px; box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
[data-scheme="retro"] .vfader::-moz-range-track{ height: var(--track-th);
  background: linear-gradient(180deg, #3b3c41, #2b2c31);
  border-radius: 6px; box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
/* thumb */
[data-scheme="retro"] .vfader::-webkit-slider-thumb{
  -webkit-appearance: none;
  width: var(--thumb-w); height: var(--thumb-h);
  margin-top: calc((var(--track-th) - var(--thumb-h)) / 2); /* centers cap */
  border: 1px solid rgba(0,0,0,.6); border-radius: 4px;
  background:
    linear-gradient(180deg, #f2f2f2, #d8d8d8),
    linear-gradient(90deg, transparent 46%, rgba(0,0,0,.25) 48%, rgba(0,0,0,.25) 52%, transparent 54%);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
}
[data-scheme="retro"] .vfader::-moz-range-thumb{
  width: var(--thumb-w); height: var(--thumb-h);
  margin-top: calc((var(--track-th) - var(--thumb-h)) / 2);
  border: 1px solid rgba(0,0,0,.6); border-radius: 4px;
  background:
    linear-gradient(180deg, #f2f2f2, #d8d8d8),
    linear-gradient(90deg, transparent 46%, rgba(0,0,0,.25) 48%, rgba(0,0,0,.25) 52%, transparent 54%);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
}

/* LCD */
[data-scheme="retro"] .lcd-compact{
  min-width: 58px;
  height: var(--lcd-h);
  display: grid; place-items: center;
  padding: 0 8px; text-align: center;
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .06em; color: #c4ffd8;
  background: radial-gradient(120% 140% at 50% 0%, #0d1f14 0%, #0a1510 60%, #09100d 100%);
  border: 1px solid #163522; border-radius: 6px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.10), inset 0 -1px 0 rgba(0,0,0,.45),
              0 0 18px rgba(6,214,160,.18);
}

/* Solo ON — bright yellow glow */
[data-scheme="retro"] .solo-btn.edge.solo-on,
[data-scheme="retro"] .solo-btn.edge[aria-pressed="true"]{
  color: #1b0e00;
  background: linear-gradient(180deg, #ffb84d 0%, #ff9800 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  border-color: rgba(255,138,0,.75);
  box-shadow:
    0 0 22px rgba(255,185,77,.55),
    0 0 36px rgba(255,152,0,.35),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* ---------- Vol / Pitch (squares, closer to fader) ---------- */
[data-scheme="retro"] .mode-col{
  --mode-btn: clamp(48px, 5vw, 56px);
  display: flex; flex-direction: column; gap: 10px;
  align-self: center;            /* vertically centered in its grid cell */
  justify-self: start;           /* hug fader column */
  margin-left: clamp(-20px, -1.8vw, -20px);   /* nudge closer to fader */
}
[data-scheme="retro"] .mode-col .press.toggle.xs{
  width: var(--mode-btn); height: var(--mode-btn);
  padding: 0; display: grid; place-items: center; line-height: 1;
}
/* Active = green */
[data-scheme="retro"] .mode-col .press.toggle.xs.on,
[data-scheme="retro"] .mode-col .press.toggle.xs[aria-pressed="true"]{
  color: #071a12;
  background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  border-color: rgba(0,0,0,.55);
  box-shadow:
    0 0 14px rgba(6,214,160,.28),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* Phone tweak: keep the nudge but not too aggressive */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse){
    [data-scheme="retro"] .mode-col{ margin-left: -28px; }
  }



  

  /* ===========================================
   CHANNEL — bulletproof mobile fit
   =========================================== */
   @media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    /* 1) Make columns resolutely flexible on phones */
    [data-scheme="retro"] .channel-block.pads-left {
      /* tighten everything a bit on mobile */
      --pad-size: clamp(48px, 26vw, 110px);
      --pad-gap: 8px;
      --extra-pad-fader-gap: 10px;
  
      /* Left col (pads) gets exact width; middle flexes; right stays visible */
      grid-template-columns:
        minmax(0, var(--pads-col-w))
        minmax(0, 1fr)
        max-content;
  
      column-gap: 10px;
      box-sizing: border-box;
      width: 100%;
      max-width: 100%;
      padding-right: max(8px, env(safe-area-inset-right)); /* iOS safe area */
    }
  
    /* 2) Remove the pad grid left offset on phones */
    [data-scheme="retro"] .pads-2x2.tiny-gap {
      margin-left: 0 !important;
    }
  
    /* 3) Let middle/right pieces actually shrink when tight */
    [data-scheme="retro"] .channel-block.pads-left > * { min-width: 0; }
    [data-scheme="retro"] .vfader-wrap,
    [data-scheme="retro"] .mode-col { min-width: 0; }
  
    /* 4) Slimmer fader slot + LCD so the right column gains a few px */
    [data-scheme="retro"] .vfader-slot { width: 26px; }            /* was 30px */
    [data-scheme="retro"] .lcd-compact {
      min-width: 48px;                                              /* was 58px */
      padding: 0 6px;
    }
  
    /* 5) Vol/Pitch squares shrink elastically to always fit */
    [data-scheme="retro"] .mode-col {
      /* allow smaller min on phones so they never stick out */
      --mode-btn: clamp(34px, 12vw, 48px);
      margin-left: -8px !important;  /* light nudge left, not aggressive */
    }
    [data-scheme="retro"] .mode-col .press.toggle.xs {
      width: var(--mode-btn);
      height: var(--mode-btn);
    }
  }
  
  /* Ultra-tight devices (≤360px wide) get one more squeeze */
  @media (max-width: 360px) {
    [data-scheme="retro"] .channel-block.pads-left {
      --pad-size: clamp(44px, 24vw, 100px);
      --extra-pad-fader-gap: 8px;
      column-gap: 8px;
    }
    [data-scheme="retro"] .vfader-slot { width: 24px; }
    [data-scheme="retro"] .lcd-compact { min-width: 44px; padding: 0 4px; }
    [data-scheme="retro"] .mode-col { --mode-btn: clamp(30px, 14vw, 44px); margin-left: -6px !important; }
  }
  

  /* ===========================================
   Buttons: solid inactive styles on phones only
   =========================================== */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    /* Make sure iOS doesn’t impose native rounded/white look */
    [data-scheme="retro"] .mode-col .press.toggle.xs,
    [data-scheme="retro"] .solo-btn.edge {
      appearance: none;
      -webkit-appearance: none;
    }
  
    /* Vol / Pitch — INACTIVE (square + grey-ish) */
    [data-scheme="retro"] .mode-col .press.toggle.xs:not(.on):not([aria-pressed="true"]) {
      border-radius: 6px; /* edgy */
      border: 1px solid rgba(0,0,0,.6);
      color: #e6e7eb;
      background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
      box-shadow: 0 2px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
      transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
    }
    [data-scheme="retro"] .mode-col .press.toggle.xs:not(.on):not([aria-pressed="true"]):hover {
      filter: brightness(1.06);
    }
    [data-scheme="retro"] .mode-col .press.toggle.xs:not(.on):not([aria-pressed="true"]):active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
    }
  
    /* Solo — INACTIVE (edgy + grey-ish) */
    [data-scheme="retro"] .solo-btn.edge:not(.solo-on):not([aria-pressed="true"]) {
      border-radius: 6px; /* edgy */
      border: 1px solid rgba(0,0,0,.6);
      color: #dddfe6;
      background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
      box-shadow: 0 2px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
      transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
    }
    [data-scheme="retro"] .solo-btn.edge:not(.solo-on):not([aria-pressed="true"]):hover {
      filter: brightness(1.06);
    }
    [data-scheme="retro"] .solo-btn.edge:not(.solo-on):not([aria-pressed="true"]):active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
    }
  
    /* (Optional) If you show "Volume"/"Pitch" text, keep them compact on phones */
    [data-scheme="retro"] .mode-col .press.toggle.xs {
      font-size: 12px;
      line-height: 1;
      /* if you added V/P abbreviation spans earlier, they’ll still work */
    }
  }
  

/* =========================
   SIDECCHAIN — Retro match
   ========================= */
   [data-scheme="retro"] .sc-panel{
    margin-top: 8px;
    margin-left: var(--space-4);                 /* align with pads/other sections */
    display: grid;
    gap: 12px;
    margin-left: 0; 
  }
  
  /* Header: tiny counter chip */
  [data-scheme="retro"] .sc-header{
    display: flex; align-items: center; gap: 8px;
  }
  [data-scheme="retro"] .sc-counter{
    display: inline-flex; align-items: center; justify-content: center;
    min-width: 86px; height: 26px; padding: 0 10px;
    font: 800 11px/1 "Orbitron", var(--font-ui);
    letter-spacing: .06em; color: #c4ffd8;
    background: radial-gradient(120% 140% at 50% 0%, #0d1f14 0%, #0a1510 60%, #09100d 100%);
    border: 1px solid #163522; border-radius: 6px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.10), inset 0 -1px 0 rgba(0,0,0,.45),
                0 0 12px rgba(6,214,160,.18);
  }
  
  /* Target buttons grid */
  [data-scheme="retro"] .sc-targets{
    display: grid;
    grid-template-columns: repeat(5, minmax(84px, 1fr));
    gap: 8px;
  }
  @media (max-width: 820px){
    [data-scheme="retro"] .sc-targets{
      grid-template-columns: repeat(auto-fit, minmax(96px, 1fr));
    }
  }
  
  /* Buttons (reuse slab look; “on” = green glow) */
  [data-scheme="retro"] .sc-btn{
    min-height: 36px;
    padding: 0 12px;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,.6);
    background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
    color: #e9e9ee;
    box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
    font: 800 11px/1 "Orbitron", var(--font-ui);
    letter-spacing: .06em;
    transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
  }
  [data-scheme="retro"] .sc-btn:hover{ filter: brightness(1.06); }
  [data-scheme="retro"] .sc-btn:active{ transform: translateY(1px); }
  [data-scheme="retro"] .sc-btn.on{
    color: #071a12;
    background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
    text-shadow: 0 1px 0 rgba(255,255,255,.35);
    border-color: rgba(0,0,0,.55);
    box-shadow: 0 0 14px rgba(6,214,160,.28), 0 3px 0 rgba(0,0,0,.45),
                inset 0 1px 0 rgba(255,255,255,.35);
  }
  [data-scheme="retro"] .sc-btn[disabled]{
    opacity: .55; cursor: not-allowed; filter: grayscale(.25);
  }
  
  /* Three parameter sliders (AMT/ATK/REL) */
  [data-scheme="retro"] .sc-params{
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
  }
  @media (max-width: 640px){
    [data-scheme="retro"] .sc-params{ grid-template-columns: 1fr; }
  }
  [data-scheme="retro"] .sc-param{ display: grid; gap: 6px; }
  
  /* Sub-labels */
  [data-scheme="retro"] .fx-sublabel{
    font: 800 10px/1 "Orbitron", var(--font-ui);
    letter-spacing: .14em; text-transform: uppercase;
    color: #d6d7db; opacity: .8;
  }
  
  /* Horizontal FX slider styling (matches your fader family) */
  [data-scheme="retro"] .slider.slider-fx{
    appearance: none; -webkit-appearance: none;
    height: 20px; width: 100%; background: transparent; outline: none;
  }
  [data-scheme="retro"] .slider.slider-fx::-webkit-slider-runnable-track{
    height: 8px; border-radius: 6px;
    background: linear-gradient(180deg, #3b3c41, #2b2c31);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
  }
  [data-scheme="retro"] .slider.slider-fx::-moz-range-track{
    height: 8px; border-radius: 6px;
    background: linear-gradient(180deg, #3b3c41, #2b2c31);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
  }
  [data-scheme="retro"] .slider.slider-fx::-webkit-slider-thumb{
    -webkit-appearance: none; margin-top: -9px;   /* (8 - 26)/2 */
    width: 16px; height: 26px; border-radius: 4px;
    border: 1px solid rgba(0,0,0,.6);
    background:
      linear-gradient(180deg, #f2f2f2, #d8d8d8),
      linear-gradient(90deg, transparent 46%, rgba(0,0,0,.25) 48%, rgba(0,0,0,.25) 52%, transparent 54%);
    box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
  }
  [data-scheme="retro"] .slider.slider-fx::-moz-range-thumb{
    width: 16px; height: 26px; border-radius: 4px;
    border: 1px solid rgba(0,0,0,.6);
    background:
      linear-gradient(180deg, #f2f2f2, #d8d8d8),
      linear-gradient(90deg, transparent 46%, rgba(0,0,0,.25) 48%, rgba(0,0,0,.25) 52%, transparent 54%);
    box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
  }
  


  /* =========================
   FX — Retro match
   ========================= */
:root[data-scheme="retro"] .fx-row.fx-panel.three,
[data-scheme="retro"] .fx-row.fx-panel.three {
  --fx-gap: 12px;
  margin-left: var(--space-4);
  margin-right: var(--space-4);
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: var(--fx-gap);
}

/* stack to 1 col on phones, 2 cols on medium */
@media (max-width: 920px) {
  :root[data-scheme="retro"] .fx-row.fx-panel.three { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 640px) {
  :root[data-scheme="retro"] .fx-row.fx-panel.three { grid-template-columns: 1fr; }
}

/* ===== Card ===== */
:root[data-scheme="retro"] .fx-block,
[data-scheme="retro"] .fx-block {
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.55);
  background:
    radial-gradient(120% 180% at 50% 0%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow:
    0 6px 16px rgba(0,0,0,.25),
    inset 0 1px 0 rgba(255,255,255,.08);
}

/* ===== Labels ===== */
:root[data-scheme="retro"] .fx-label,
[data-scheme="retro"] .fx-label {
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .10em;
  color: #e9e9ee;
  margin-bottom: 6px;
  text-shadow: 0 1px 0 rgba(0,0,0,.6);
}
:root[data-scheme="retro"] .fx-sublabel,
[data-scheme="retro"] .fx-sublabel {
  font: 800 10px/1 "Orbitron", var(--font-ui);
  letter-spacing: .10em;
  color: #cfd2da;
  opacity: .85;
  margin-bottom: 6px;
}

/* ===== Sliders (FX) ===== */
:root[data-scheme="retro"] .slider.slider-fx,
[data-scheme="retro"] .slider.slider-fx {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 22px; /* control box */
  background: transparent;
  margin: 0;
}
:root[data-scheme="retro"] .slider.slider-fx::-webkit-slider-runnable-track {
  height: 6px;
  border-radius: 6px;
  background: linear-gradient(90deg, #3b3c41, #2b2c31);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
:root[data-scheme="retro"] .slider.slider-fx::-moz-range-track {
  height: 6px;
  border-radius: 6px;
  background: linear-gradient(90deg, #3b3c41, #2b2c31);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
:root[data-scheme="retro"] .slider.slider-fx::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px; height: 18px;
  margin-top: -6px; /* center over 6px track */
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,.6);
  background: linear-gradient(180deg, #f2f2f2, #d8d8d8);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
  cursor: pointer;
}
:root[data-scheme="retro"] .slider.slider-fx::-moz-range-thumb {
  width: 18px; height: 18px;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,.6);
  background: linear-gradient(180deg, #f2f2f2, #d8d8d8);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
  cursor: pointer;
}

/* ===== Mode/length buttons (reuse Sidechain look) ===== */
:root[data-scheme="retro"] .revlen-wrap,
[data-scheme="retro"] .revlen-wrap { display: flex; gap: 6px; margin-top: 8px; }

:root[data-scheme="retro"] .revlen-btn,
[data-scheme="retro"] .revlen-btn {
  min-width: 36px;
  height: 26px;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 11px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  display: grid; place-items: center;
  transition: filter .15s, transform .05s, box-shadow .2s, background .2s;
  cursor: pointer;
}
:root[data-scheme="retro"] .revlen-btn:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .revlen-btn:active { transform: translateY(1px); }
:root[data-scheme="retro"] .revlen-btn.on,
[data-scheme="retro"] .revlen-btn[aria-pressed="true"] {
  color: #071a12;
  background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  border-color: rgba(0,0,0,.55);
  box-shadow:
    0 0 14px rgba(6,214,160,.28),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}
:root[data-scheme="retro"] .revlen-btn:disabled {
  opacity: .6; cursor: not-allowed; filter: none;
}




/* ===== Retro shimmer tints for Sidechain + FX ===== */
:root[data-scheme="retro"]{
    /* tweak alphas to taste */
    --sc-tint-1: rgba(6,214,160,.12);  /* sidechain = warm green */
    --sc-tint-2: rgba(6,214,160,.08);
  
    --fx-dly-1: rgba(17,138,178,.12);  /* FX: Delay = cyan-blue */
    --fx-dly-2: rgba(17,138,178,.08);
  
    --fx-rev-1: rgba(239,71,111,.12);  /* FX: Reverb = magenta */
    --fx-rev-2: rgba(239,71,111,.08);
  
    --fx-sat-1: rgba(255,209,102,.12); /* FX: Saturation = amber */
    --fx-sat-2: rgba(255,209,102,.08);
  }
  
  /* Sidechain card (your SidechainPanel wraps with .fx-block.sc-panel) */
  [data-scheme="retro"] .fx-block.sc-panel{
    background:
      radial-gradient(140% 180% at 0% -20%, var(--sc-tint-1), transparent 60%),
      linear-gradient(90deg, var(--sc-tint-2), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
    border-color: rgba(6,214,160,.22);
    box-shadow:
      0 6px 16px rgba(0,0,0,.25),
      inset 0 1px 0 rgba(255,255,255,.08),
      0 0 0 1px rgba(6,214,160,.08);
  }
  [data-scheme="retro"] .fx-block.sc-panel:hover{
    background:
      radial-gradient(140% 180% at 0% -20%, rgba(6,214,160,.14), transparent 60%),
      linear-gradient(90deg, rgba(6,214,160,.10), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  }
  
  /* FX cards (Delay | Reverb | Saturation) by position: 1,2,3 */
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(1){
    background:
      radial-gradient(140% 180% at 0% -20%, var(--fx-dly-1), transparent 60%),
      linear-gradient(90deg, var(--fx-dly-2), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
    border-color: rgba(17,138,178,.22);
    box-shadow:
      0 6px 16px rgba(0,0,0,.25),
      inset 0 1px 0 rgba(255,255,255,.08),
      0 0 0 1px rgba(17,138,178,.08);
  }
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(1):hover{
    background:
      radial-gradient(140% 180% at 0% -20%, rgba(17,138,178,.14), transparent 60%),
      linear-gradient(90deg, rgba(17,138,178,.10), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  }
  
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(2){
    background:
      radial-gradient(140% 180% at 50% -20%, var(--fx-rev-1), transparent 60%),
      linear-gradient(90deg, var(--fx-rev-2), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
    border-color: rgba(239,71,111,.22);
    box-shadow:
      0 6px 16px rgba(0,0,0,.25),
      inset 0 1px 0 rgba(255,255,255,.08),
      0 0 0 1px rgba(239,71,111,.08);
  }
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(2):hover{
    background:
      radial-gradient(140% 180% at 50% -20%, rgba(239,71,111,.14), transparent 60%),
      linear-gradient(90deg, rgba(239,71,111,.10), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  }
  
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(3){
    background:
      radial-gradient(140% 180% at 100% -20%, var(--fx-sat-1), transparent 60%),
      linear-gradient(270deg, var(--fx-sat-2), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
    border-color: rgba(255,209,102,.22);
    box-shadow:
      0 6px 16px rgba(0,0,0,.25),
      inset 0 1px 0 rgba(255,255,255,.08),
      0 0 0 1px rgba(255,209,102,.08);
  }
  [data-scheme="retro"] .fx-row.fx-panel.three > .fx-block:nth-child(3):hover{
    background:
      radial-gradient(140% 180% at 100% -20%, rgba(255,209,102,.14), transparent 60%),
      linear-gradient(270deg, rgba(255,209,102,.10), transparent 60%),
      linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  }

  


/* =========================
   GROOVE
   ========================= */
:root[data-scheme="retro"] .swing-card.compact,
[data-scheme="retro"] .swing-card.compact{
  --s-gap: 12px;

  margin-left: var(--space-4);
  margin-right: var(--space-4);
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,.55);
  background:
    radial-gradient(120% 180% at 50% 0%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow:
    0 6px 16px rgba(0,0,0,.25),
    inset 0 1px 0 rgba(255,255,255,.08);

  display: grid;
  grid-template-columns: auto 1fr 1fr; /* grid selector | inst | global */
  align-items: center;
  gap: var(--s-gap);
}

/* 2×2 selector stays square & compact */
:root[data-scheme="retro"] .swing-grid-2x2{
  --sg-size: clamp(44px, 4.8vw, 56px);
  --sg-gap: 10px;
  display: grid;
  grid-template-columns: repeat(2, var(--sg-size));
  grid-auto-rows: var(--sg-size);
  gap: var(--sg-gap);
  justify-content: start;
}
:root[data-scheme="retro"] .sg2-btn{
  width: var(--sg-size);
  height: var(--sg-size);
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  display: grid; place-items: center;
  transition: filter .15s, transform .05s, box-shadow .2s, background .2s;
  cursor: pointer;
}
:root[data-scheme="retro"] .sg2-btn:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .sg2-btn:active { transform: translateY(1px); }
:root[data-scheme="retro"] .sg2-btn.on,
:root[data-scheme="retro"] .sg2-btn[aria-pressed="true"]{
  color: #071a12;
  background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  border-color: rgba(0,0,0,.55);
  box-shadow:
    0 0 14px rgba(6,214,160,.28),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* Inline blocks: sublabel + slider/LCD on one line */
:root[data-scheme="retro"] .swing-inline{
  display: grid;
  grid-template-rows: auto auto;
  gap: 6px;
}
:root[data-scheme="retro"] .swing-slider-row{
  display: grid;
  grid-template-columns: 1fr auto; /* slider | lcd */
  align-items: center;
  gap: 10px;
}

/* Reuse your sublabel */
:root[data-scheme="retro"] .fx-sublabel{
  font: 800 10px/1 "Orbitron", var(--font-ui);
  letter-spacing: .10em;
  color: #cfd2da; opacity: .85;
}

/* Sliders (match FX look, slightly slimmer) */
:root[data-scheme="retro"] .slider.slider-swing,
:root[data-scheme="retro"] .slider.slider-global{
  -webkit-appearance: none; appearance: none;
  width: 100%; height: 22px; background: transparent; margin: 0; cursor: pointer;
}
:root[data-scheme="retro"] .slider.slider-swing:disabled{ opacity:.6; cursor:not-allowed; }
:root[data-scheme="retro"] .slider.slider-swing::-webkit-slider-runnable-track,
:root[data-scheme="retro"] .slider.slider-global::-webkit-slider-runnable-track{
  height: 6px; border-radius: 6px;
  background: linear-gradient(90deg, #3b3c41, #2b2c31);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
:root[data-scheme="retro"] .slider.slider-swing::-moz-range-track,
:root[data-scheme="retro"] .slider.slider-global::-moz-range-track{
  height: 6px; border-radius: 6px;
  background: linear-gradient(90deg, #3b3c41, #2b2c31);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
}
:root[data-scheme="retro"] .slider.slider-swing::-webkit-slider-thumb,
:root[data-scheme="retro"] .slider.slider-global::-webkit-slider-thumb{
  -webkit-appearance: none;
  width: 18px; height: 18px; margin-top: -6px;
  border-radius: 6px; border: 1px solid rgba(0,0,0,.6);
  background: linear-gradient(180deg, #f2f2f2, #d8d8d8);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
}
:root[data-scheme="retro"] .slider.slider-swing::-moz-range-thumb,
:root[data-scheme="retro"] .slider.slider-global::-moz-range-thumb{
  width: 18px; height: 18px;
  border-radius: 6px; border: 1px solid rgba(0,0,0,.6);
  background: linear-gradient(180deg, #f2f2f2, #d8d8d8);
  box-shadow: 0 2px 0 rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.7);
}

/* Compact LCDs */
:root[data-scheme="retro"] .swing-lcd{
  min-width: 78px; height: 24px;
  display: grid; place-items: center;
  padding: 0 8px;
  font: 800 11px/1 "Orbitron", var(--font-ui);
  letter-spacing: .06em; color: #c4ffd8;
  background: radial-gradient(120% 140% at 50% 0%, #0d1f14 0%, #0a1510 60%, #09100d 100%);
  border: 1px solid #163522; border-radius: 6px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.10), inset 0 -1px 0 rgba(0,0,0,.45),
              0 0 14px rgba(6,214,160,.16);
}
:root[data-scheme="retro"] .swing-lcd.is-disabled{ opacity:.65; }
:root[data-scheme="retro"] .swing-lcd .lcd-value{ font-weight:900; }

/* Responsive: collapse to 2 cols, then 1 */
@media (max-width: 920px){
  :root[data-scheme="retro"] .swing-card.compact{
    grid-template-columns: auto 1fr; /* selector | the two rows stack */
  }
}
@media (max-width: 640px){
  :root[data-scheme="retro"] .swing-card.compact{
    grid-template-columns: 1fr;      /* full stack */
    row-gap: 12px;
  }
}

/* Inline selector row */
:root[data-scheme="retro"] .swing-grid-inline,
[data-scheme="retro"] .swing-grid-inline{
  --sg-size: clamp(40px, 4.4vw, 52px); /* slightly smaller squares */
  --sg-gap: 10px;
  display: grid;
  grid-auto-flow: column;               /* lay them out left→right */
  grid-auto-columns: var(--sg-size);    /* each button is a square */
  gap: var(--sg-gap);
  justify-content: start;
  align-items: center;
}

/* Reuse existing .sg2-btn visuals (square) */
:root[data-scheme="retro"] .sg2-btn,
[data-scheme="retro"] .sg2-btn{
  width: var(--sg-size);
  height: var(--sg-size);
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 12px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  display: grid; place-items: center;
  transition: filter .15s, transform .05s, box-shadow .2s, background .2s;
  cursor: pointer;
}
:root[data-scheme="retro"] .sg2-btn:hover { filter: brightness(1.06); }
:root[data-scheme="retro"] .sg2-btn:active { transform: translateY(1px); }
:root[data-scheme="retro"] .sg2-btn.on,
:root[data-scheme="retro"] .sg2-btn[aria-pressed="true"]{
  color: #071a12;
  background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  border-color: rgba(0,0,0,.55);
  box-shadow:
    0 0 14px rgba(6,214,160,.28),
    0 3px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* Adjust the card columns to account for the narrower selector */
:root[data-scheme="retro"] .swing-card.compact,
[data-scheme="retro"] .swing-card.compact{
  grid-template-columns: auto 1fr 1fr;   /* selector | inst | global */
}

/* Responsive falls back as before */
@media (max-width: 920px){
  :root[data-scheme="retro"] .swing-card.compact{ grid-template-columns: auto 1fr; }
}
@media (max-width: 640px){
  :root[data-scheme="retro"] .swing-card.compact{ grid-template-columns: 1fr; row-gap: 12px; }
}


/* =========================
   SUM BUS — Retro slab
   ========================= */
   :root[data-scheme="retro"] .sbus-card,
   [data-scheme="retro"] .sbus-card{
     margin-left: var(--space-4);
     margin-right: var(--space-4);
     padding: 12px;
     border-radius: 12px;
     border: 1px solid rgba(0,0,0,.55);
     background:
       radial-gradient(120% 180% at 50% 0%, rgba(255,255,255,.06), transparent 60%),
       linear-gradient(180deg, #2e2f34 0%, #222329 100%);
     box-shadow:
       0 6px 16px rgba(0,0,0,.25),
       inset 0 1px 0 rgba(255,255,255,.08);
   }
   
   /* Header */
   :root[data-scheme="retro"] .sbus-header,
   [data-scheme="retro"] .sbus-header{
     display:flex; align-items:center; justify-content:space-between;
     gap: 12px;
   }
   :root[data-scheme="retro"] .sbus-title,
   [data-scheme="retro"] .sbus-title{
     font: 800 12px/1 "Orbitron", var(--font-ui);
     letter-spacing:.12em; text-transform:uppercase; color:#e9e9ee; opacity:.9;
   }
   
   /* Limiter toggle chip */
   :root[data-scheme="retro"] .toggle-chip,
   [data-scheme="retro"] .toggle-chip{
     min-width: 78px; height: 28px; padding: 0 12px;
     border-radius: 8px; border: 1px solid rgba(0,0,0,.6);
     color:#f4f4f4; background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
     box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
     font: 800 11px/1 "Orbitron", var(--font-ui); letter-spacing:.08em;
     display:grid; place-items:center; cursor:pointer;
     transition: filter .15s, transform .05s, box-shadow .2s, background .2s;
   }
   :root[data-scheme="retro"] .toggle-chip:hover{ filter:brightness(1.06); }
   :root[data-scheme="retro"] .toggle-chip:active{ transform:translateY(1px); }
   :root[data-scheme="retro"] .toggle-chip.on,
   [data-scheme="retro"] .toggle-chip[aria-pressed="true"]{
     color:#071a12;
     background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
     text-shadow: 0 1px 0 rgba(255,255,255,.35);
     border-color: rgba(0,0,0,.55);
     box-shadow:
       0 0 14px rgba(6,214,160,.28),
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.35);
   }
   
   /* Grid */
   :root[data-scheme="retro"] .sbus-grid,
   [data-scheme="retro"] .sbus-grid{
     display:grid;
     grid-template-columns: 1.2fr 1fr .9fr;
     gap: 16px;
     margin-top: 12px;
   }
   :root[data-scheme="retro"] .sbus-block{ display:grid; gap:8px; }
   
   /* Peak meter */
   :root[data-scheme="retro"] .sbus-meter,
   [data-scheme="retro"] .sbus-meter{
     height: 12px; border-radius: 6px; overflow: hidden;
     background: linear-gradient(180deg, #3b3c41, #2b2c31);
     box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -1px 0 rgba(0,0,0,.35);
   }
   :root[data-scheme="retro"] .sbus-meter__bar{ height:100%; transition: width 60ms linear; }
   :root[data-scheme="retro"] .sbus-meter__bar.ok{
     background: linear-gradient(90deg, #19c27e, #10b981);
     box-shadow: 0 0 10px rgba(16,185,129,.25) inset;
   }
   :root[data-scheme="retro"] .sbus-meter__bar.warn{
     background: linear-gradient(90deg, #f0b429, #d97706);
     box-shadow: 0 0 10px rgba(233,156,24,.25) inset;
   }
   :root[data-scheme="retro"] .sbus-meter__bar.hot{
     background: linear-gradient(90deg, #ff6b6b, #b91c1c);
     box-shadow: 0 0 12px rgba(239,71,111,.35) inset;
   }
   
   /* LCD readout */
   :root[data-scheme="retro"] .sbus-lcd,
   [data-scheme="retro"] .sbus-lcd{
     min-width: 90px; height: 26px;
     display:grid; place-items:center;
     font: 800 11px/1 "Orbitron", var(--font-ui);
     letter-spacing:.06em; color:#c4ffd8;
     background: radial-gradient(120% 140% at 50% 0%, #0d1f14 0%, #0a1510 60%, #09100d 100%);
     border:1px solid #163522; border-radius:6px;
     box-shadow:
       inset 0 1px 0 rgba(255,255,255,.10),
       inset 0 -1px 0 rgba(0,0,0,.45),
       0 0 14px rgba(6,214,160,.16);
   }
   
   /* Labeled rows in COMP */
   :root[data-scheme="retro"] .sbus-row,
   [data-scheme="retro"] .sbus-row{
     display:grid; grid-template-columns: 62px 1fr; align-items:center; gap:8px;
   }
   :root[data-scheme="retro"] .sbus-row > span{
     font: 800 10px/1 "Orbitron", var(--font-ui);
     letter-spacing:.10em; color:#cfd2da; opacity:.85;
   }
   
   /* Makeup readout & toggles */
   :root[data-scheme="retro"] .sbus-readout,
   [data-scheme="retro"] .sbus-readout{
     font: 800 11px/1 var(--font-ui); color:#e9e9ee; opacity:.9;
     margin-top: 4px;
   }
   :root[data-scheme="retro"] .sbus-toggles,
   [data-scheme="retro"] .sbus-toggles{
     display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;
   }
   
   /* Sliders reuse your .slider.slider-fx visuals */
   
   /* Responsive */
   @media (max-width: 880px){
     :root[data-scheme="retro"] .sbus-grid{ grid-template-columns: 1fr 1fr; }
   }
   @media (max-width: 620px){
     :root[data-scheme="retro"] .sbus-grid{ grid-template-columns: 1fr; }
   }
   
   :root[data-scheme="retro"] .sbus-head,
[data-scheme="retro"] .sbus-head{
  display: flex;
  align-items: baseline;      /* keeps numbers aligned nicely with the label */
  justify-content: space-between; /* label left, value right */
  gap: 8px;
  margin-bottom: 6px;
}

/* remove the readout's default top margin when used in the head row */
:root[data-scheme="retro"] .sbus-head .sbus-readout,
[data-scheme="retro"] .sbus-head .sbus-readout{
  margin: 0;
}




/* ==== Always-on shimmer (no hover boost) ==== */
:root[data-scheme="retro"] .swing-card.compact,
[data-scheme="retro"] .swing-card.compact,
:root[data-scheme="retro"] .sbus-card,
[data-scheme="retro"] .sbus-card {
  position: relative;
  overflow: hidden;               /* keep overlay inside the card */
  /* force the base “metal” background so :hover can't swap it */
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%) !important;
}

/* GROOVE overlay */
:root[data-scheme="retro"] .swing-card.compact::before,
[data-scheme="retro"] .swing-card.compact::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* use the stronger alphas you liked */
  background:
    radial-gradient(140% 180% at 100% -25%, rgba(17,138,178,.16), transparent 60%),
    linear-gradient(90deg, rgba(6,214,160,.12), transparent 60%);
  opacity: 1;                      /* always on */
}

/* SUM BUS overlay */
:root[data-scheme="retro"] .sbus-card::before,
[data-scheme="retro"] .sbus-card::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(50% 100% at   0% -25%, rgba(255,209,152,.16), transparent 60%),
    linear-gradient(90deg, rgba(239,71,111,.10), transparent 60%);
  opacity: 1;
}

/* Kill any old hover pop (same look on hover) */
:root[data-scheme="retro"] .swing-card.compact:hover,
[data-scheme="retro"] .swing-card.compact:hover,
:root[data-scheme="retro"] .sbus-card:hover,
[data-scheme="retro"] .sbus-card:hover {
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%) !important;
  filter: none !important;
}

  
  

  

/* =========================
   TRANSPORT — Retro
   ========================= */
   :root[data-scheme="retro"] .transport,
   [data-scheme="retro"] .transport{
     margin-left: var(--space-4);
     margin-right: var(--space-4);
     margin-top: 8px;
     padding: 10px 12px;
     border-radius: 12px;
     border: 1px solid rgba(0,0,0,.55);
     background:
       radial-gradient(120% 180% at 50% 0%, rgba(255,255,255,.06), transparent 60%),
       linear-gradient(180deg, #2e2f34 0%, #222329 100%);
     box-shadow:
       0 6px 16px rgba(0,0,0,.25),
       inset 0 1px 0 rgba(255,255,255,.08);
     
     display: grid;
     grid-template-columns: auto auto 1fr auto auto; /* ▶ / ● | spacer | Del Pat | Del All */
     align-items: center;
     column-gap: 12px;
   }
   
   /* LCD — centered step readout */
   :root[data-scheme="retro"] .transport .lcd,
   [data-scheme="retro"] .transport .lcd{
     justify-self: center;
     min-width: 90px;
     height: 40px;
     display: grid;
     place-items: center;
     padding: 0 10px;
     font: 800 12px/1 "Orbitron", var(--font-ui);
     letter-spacing: .06em;
     color: #c4ffd8;
     background: radial-gradient(120% 140% at 50% 0%, #0d1f14 0%, #0a1510 60%, #09100d 100%);
     border: 1px solid #163522;
     border-radius: 6px;
     box-shadow:
       inset 0 1px 0 rgba(255,255,255,.10),
       inset 0 -1px 0 rgba(0,0,0,.45),
       0 0 14px rgba(6,214,160,.16);
   }
   
   /* Base transport buttons */
   :root[data-scheme="retro"] .transport .btn.press,
   [data-scheme="retro"] .transport .btn.press{
     min-width: 44px;
     height: 40px;
     padding: 0 12px;
     border-radius: 2px;
     border: 1px solid rgba(0,0,0,.6);
     color: #f4f4f4;
     background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
     box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
     font: 800 11px/1 "Orbitron", var(--font-ui);
     letter-spacing: .06em;
     display: grid; place-items: center;
     transition: filter .15s, transform .05s, box-shadow .2s, background .2s, color .2s;
     cursor: pointer;
   }
   :root[data-scheme="retro"] .transport .btn.press:hover{ filter: brightness(1.06); }
   :root[data-scheme="retro"] .transport .btn.press:active{ transform: translateY(1px); }
   
   /* Play / Stop combo (triangle/square) */
   :root[data-scheme="retro"] .transport .playstop,
   [data-scheme="retro"] .transport .playstop{
     width: 52px; height: 36px; padding: 0; position: relative;
   }
   
   /* triangle (play) */
   :root[data-scheme="retro"] .transport .playstop .tri,
   [data-scheme="retro"] .transport .playstop .tri{
     width: 0; height: 0;
     border-left: 12px solid #e9fdf5;
     border-top: 7px solid transparent;
     border-bottom: 7px solid transparent;
     filter: drop-shadow(0 0 6px rgba(31,224,179,.35));
   }
   :root[data-scheme="retro"] .transport .playstop .sq,
   [data-scheme="retro"] .transport .playstop .sq{
     width: 14px; height: 14px; border-radius: 2px;
     background: #e9fdf5;
     box-shadow: 0 0 6px rgba(31,224,179,.35);
     display: none;
   }
   
   /* When playing → show stop (square), tint button green */
   :root[data-scheme="retro"] .transport .playstop.is-playing,
   [data-scheme="retro"] .transport .playstop[aria-pressed="true"]{
     color: #071a12;
     background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
     text-shadow: 0 1px 0 rgba(255,255,255,.35);
     border-color: rgba(0,0,0,.55);
     box-shadow:
       0 0 14px rgba(6,214,160,.28),
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.35);
   }
   :root[data-scheme="retro"] .transport .playstop.is-playing .tri,
   [data-scheme="retro"] .transport .playstop[aria-pressed="true"] .tri{ display: none; }
   :root[data-scheme="retro"] .transport .playstop.is-playing .sq,
   [data-scheme="retro"] .transport .playstop[aria-pressed="true"] .sq{ display: block; }
   
   /* Record (red glow when on) */
   :root[data-scheme="retro"] .transport .rec,
   [data-scheme="retro"] .transport .rec{
     width: 44px; height: 36px; padding: 0;
   }
   :root[data-scheme="retro"] .transport .rec .rec-dot,
   [data-scheme="retro"] .transport .rec .rec-dot{
     width: 12px; height: 12px; border-radius: 50%;
     background: #f87171; /* idle tint */
     box-shadow: 0 0 0 0 rgba(244,63,94,0);
     transition: box-shadow .2s, filter .2s, background .2s;
   }
   :root[data-scheme="retro"] .transport .rec.on,
   [data-scheme="retro"] .transport .rec[aria-pressed="true"]{
     background: linear-gradient(180deg, #f87171 0%, #ef4444 100%);
     color: #2a0a0a;
     text-shadow: 0 1px 0 rgba(255,255,255,.25);
     border-color: rgba(0,0,0,.55);
     box-shadow:
       0 0 16px rgba(239,68,68,.35),
       0 3px 0 rgba(0,0,0,.45),
       inset 0 1px 0 rgba(255,255,255,.35);
   }
   :root[data-scheme="retro"] .transport .rec.on .rec-dot,
   [data-scheme="retro"] .transport .rec[aria-pressed="true"] .rec-dot{
     background: #fff1f2;
     box-shadow: 0 0 10px rgba(239,68,68,.7), 0 0 18px rgba(239,68,68,.35);
   }
   
   /* Clear buttons (Del Pat / Del All) */
   :root[data-scheme="retro"] .transport .clear-btn,
   [data-scheme="retro"] .transport .clear-btn{
     min-width: 80px;
   }
   :root[data-scheme="retro"] .transport .clear-btn.all,
   [data-scheme="retro"] .transport .clear-btn.all{
     min-width: 88px;
   }
   
   /* Optional: danger-hover for Del All */
   :root[data-scheme="retro"] .transport .clear-btn.all:hover,
   [data-scheme="retro"] .transport .clear-btn.all:hover{
     filter: brightness(1.08) saturate(1.02);
     box-shadow:
       0 0 10px rgba(255,185,77,.18),
       inset 0 1px 0 rgba(255,255,255,.12);
   }
   
   /* Responsive: tighten gaps a bit */
   @media (max-width: 640px){
     :root[data-scheme="retro"] .transport,
     [data-scheme="retro"] .transport{
       column-gap: 10px;
     }
     :root[data-scheme="retro"] .transport .clear-btn,
     [data-scheme="retro"] .transport .clear-btn{
       min-width: 72px;
     }
   }
   

   /* =========================
   TRANSPORT — phone fit only
   ========================= */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    :root[data-scheme="retro"] .transport,
    [data-scheme="retro"] .transport {
      /* spread across the screen, but keep a tiny gutter & safe areas */
      margin-left: max(6px, env(safe-area-inset-left));
      margin-right: max(6px, env(safe-area-inset-right));
      padding-left: 10px;
      padding-right: 10px;
  
      /* one flexible middle column, others auto */
      grid-template-columns: auto auto 1fr auto auto; /* ▶  ●  [LCD flex]  Del Pat  Del All */
      column-gap: 8px; /* a bit tighter */
    }
  
    /* Shorter LCD so buttons can breathe */
    :root[data-scheme="retro"] .transport .lcd,
    [data-scheme="retro"] .transport .lcd {
      min-width: 56px;          /* was 90px */
      max-width: 80px;          /* don’t let it balloon */
      height: 36px;             /* slightly shorter */
      padding: 0 6px;
      font-size: 11px;
      letter-spacing: .04em;
      justify-self: center;     /* stays centered in the flexible middle column */
    }
  
    /* Compact buttons on phones */
    :root[data-scheme="retro"] .transport .btn.press,
    [data-scheme="retro"] .transport .btn.press {
      min-width: 40px;          /* was 44px */
      height: 36px;             /* was 40px */
      padding: 0 10px;
      font-size: 10px;          /* slightly smaller label */
      letter-spacing: .04em;
    }
  
    /* Play/Stop + Record keep their look but match the height */
    :root[data-scheme="retro"] .transport .playstop,
    [data-scheme="retro"] .transport .playstop { width: 48px; height: 36px; }
    :root[data-scheme="retro"] .transport .rec,
    [data-scheme="retro"] .transport .rec { width: 40px; height: 36px; }
  
    /* Give the clear buttons room to fit side-by-side */
    :root[data-scheme="retro"] .transport .clear-btn,
    [data-scheme="retro"] .transport .clear-btn { min-width: 66px; }   /* “Del Pat” */
    :root[data-scheme="retro"] .transport .clear-btn.all,
    [data-scheme="retro"] .transport .clear-btn.all { min-width: 74px; }/* “Del All” */
  
    /* If your labels are inside <span class="sym">…</span>, tighten text a touch */
    :root[data-scheme="retro"] .transport .clear-btn .sym,
    [data-scheme="retro"] .transport .clear-btn .sym {
      font-size: 10px;
      letter-spacing: .03em;
      white-space: nowrap;
    }
  }

  /* Transport: give "Del Pat" a bit more room by slimming "Del All" (phones only) */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    :root[data-scheme="retro"] .transport,
    [data-scheme="retro"] .transport {
      column-gap: 6px; /* a touch tighter spacing */
    }
  
    /* Keep LCD just a bit slimmer to free global space */
    :root[data-scheme="retro"] .transport .lcd,
    [data-scheme="retro"] .transport .lcd {
      min-width: 54px;       /* was 56–90; tiny trim */
      max-width: 72px;
      height: 34px;
      padding: 0 6px;
      font-size: 10.5px;
    }
  
    /* Favor "Del Pat": give it a hair more min-width */
    :root[data-scheme="retro"] .transport .clear-btn.pat,
    [data-scheme="retro"] .transport .clear-btn.pat {
      min-width: 78px;       /* was ~72; gives breathing room */
      padding: 0 10px;
      box-sizing: border-box;
    }
  
    /* Slim "Del All" so it yields first */
    :root[data-scheme="retro"] .transport .clear-btn.all,
    [data-scheme="retro"] .transport .clear-btn.all {
      min-width: 66px;       /* was 74–88; smaller to help Pat */
      padding: 0 8px;
      font-size: 9.8px;      /* slightly tighter label */
      letter-spacing: .02em;
      box-sizing: border-box;
    }
  
    /* Ensure labels don't wrap or overhang */
    :root[data-scheme="retro"] .transport .clear-btn .sym,
    [data-scheme="retro"] .transport .clear-btn .sym {
      white-space: nowrap;
      line-height: 1;        /* prevents vertical clipping */
    }
  }
  

  /* Transport — slimmer "Del Pat" / "Del All" on phones only */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    /* tighten spacing a touch */
    :root[data-scheme="retro"] .transport,
    [data-scheme="retro"] .transport {
      column-gap: 6px;
    }
  
    /* base clear buttons: narrower + slightly shorter */
    :root[data-scheme="retro"] .transport .clear-btn,
    [data-scheme="retro"] .transport .clear-btn {
      min-width: 58px;          /* was ~72–80 */
      height: 34px;             /* was 40 */
      padding: 0 8px;           /* was 0 12 */
      box-sizing: border-box;
    }
  
    /* favor "Del Pat" legibility with a hair more min width */
    :root[data-scheme="retro"] .transport .clear-btn.pat,
    [data-scheme="retro"] .transport .clear-btn.pat {
      min-width: 62px;
    }
  
    /* "Del All" yields width first */
    :root[data-scheme="retro"] .transport .clear-btn.all,
    [data-scheme="retro"] .transport .clear-btn.all {
      min-width: 58px;          /* smaller than Pat */
    }
  
    /* tighten the label so it never kisses the frame */
    :root[data-scheme="retro"] .transport .clear-btn .sym,
    [data-scheme="retro"] .transport .clear-btn .sym {
      font-size: 9.8px;         /* slightly smaller text */
      letter-spacing: .01em;    /* less tracking */
      white-space: nowrap;
      line-height: 1;
      display: inline-block;    /* allows scaleX */
      transform: scaleX(.95);   /* subtle horizontal condense */
      transform-origin: center;
    }
  }
  
  /* Ultra-tight phones (≤360px) — one more notch slimmer */
  @media (max-width: 360px) and (any-hover: none) and (any-pointer: coarse) {
    :root[data-scheme="retro"] .transport .clear-btn,
    [data-scheme="retro"] .transport .clear-btn { min-width: 54px; }
    :root[data-scheme="retro"] .transport .clear-btn.pat,
    [data-scheme="retro"] .transport .clear-btn.pat { min-width: 58px; }
    :root[data-scheme="retro"] .transport .clear-btn .sym,
    [data-scheme="retro"] .transport .clear-btn .sym { font-size: 9.4px; transform: scaleX(.92); }
  }
  

  /* =========================
   TRANSPORT — phones: wider frame + equal LCD height
   ========================= */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    /* Wider bar with comfy inner padding */
    :root[data-scheme="retro"] .transport,
    [data-scheme="retro"] .transport {
      margin-left:  max(2px, env(safe-area-inset-left));   /* a bit wider than before */
      margin-right: max(2px, env(safe-area-inset-right));
      padding: 10px 10px;                                   /* more inner gap to the frame */
      grid-template-columns: auto auto 1fr auto auto;       /* ▶  ●  [LCD flex]  Del Pat  Del All */
      column-gap: 9px;                                      /* subtle breathing room */
    }
  
    /* Make LCD exactly the same height as buttons */
    :root[data-scheme="retro"] .transport .lcd,
    [data-scheme="retro"] .transport .lcd {
      height: 40px;               /* match buttons */
      min-width: 54px;            /* compact */
      max-width: 84px;            /* don’t let it balloon */
      padding: 0 8px;
      font-size: 11px;
      letter-spacing: .04em;
      justify-self: center;
    }
  
    /* Button sizes (kept compact so everything fits) */
    :root[data-scheme="retro"] .transport .btn.press,
    [data-scheme="retro"] .transport .btn.press {
      min-width: 40px;
      height: 36px;               /* matches LCD */
      padding: 0 10px;
      font-size: 10px;
      letter-spacing: .04em;
    }
  
    /* Play/Stop + Record match height */
    :root[data-scheme="retro"] .transport .playstop,
    [data-scheme="retro"] .transport .playstop { width: 48px; height: 36px; }
    :root[data-scheme="retro"] .transport .rec,
    [data-scheme="retro"] .transport .rec { width: 40px; height: 36px; }
  
    /* Slimmer clear buttons so all elements fit inside the frame */
    :root[data-scheme="retro"] .transport .clear-btn,
    [data-scheme="retro"] .transport .clear-btn { min-width: 56px; }
    :root[data-scheme="retro"] .transport .clear-btn.pat,
    [data-scheme="retro"] .transport .clear-btn.pat { min-width: 60px; } /* tiny favor for "Del Pat" text */
    :root[data-scheme="retro"] .transport .clear-btn.all,
    [data-scheme="retro"] .transport .clear-btn.all { min-width: 56px; }
  
    /* Labels stay tidy and never wrap */
    :root[data-scheme="retro"] .transport .clear-btn .sym,
    [data-scheme="retro"] .transport .clear-btn .sym {
      white-space: nowrap;
      line-height: 1;
      font-size: 10px;
      letter-spacing: .02em;
      display: inline-block;
      transform: scaleX(.95);
      transform-origin: center;
    }
  }
  

   /* =========================
   STEP EDITOR — Retro + mobile width
   ========================= */
:root[data-scheme="retro"] .step-editor,
[data-scheme="retro"] .step-editor{
  margin-left: var(--space-4);
  margin-right: var(--space-4);
  max-width: 1024px; /* desktop comfort */
}

/* Stack rows with tidy gaps */
:root[data-scheme="retro"] .step-row,
[data-scheme="retro"] .step-row{
  display: grid;
  grid-template-rows: auto auto;
  row-gap: 8px;
}

/* Row header: A/B button on left, chevron on right */
:root[data-scheme="retro"] .row-head,
[data-scheme="retro"] .row-head{
  display: flex;
  align-items: center;
}

/* A/B button – reuse your slab look */
:root[data-scheme="retro"] .btn.btn-ab,
[data-scheme="retro"] .btn.btn-ab{
  min-width: 44px;
  height: 44px;
  padding: 0 1px;
  border-radius: 1px;
  border: 1px solid rgba(0,0,0,.6);
  color: #f4f4f4;
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  box-shadow: 0 3px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 14px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  transition: filter .15s, transform .05s, box-shadow .2s, background .2s;
  cursor: pointer;
}
:root[data-scheme="retro"] .btn.btn-ab:hover,
[data-scheme="retro"] .btn.btn-ab:hover{ filter: brightness(1.06); }
:root[data-scheme="retro"] .btn.btn-ab:active,
[data-scheme="retro"] .btn.btn-ab:active{ transform: translateY(1px); }

/* Chevron button */
:root[data-scheme="retro"] .btn.btn-ab-chevron,
[data-scheme="retro"] .btn.btn-ab-chevron{
  min-width: 44px;
  height: 44px;
  border-radius: 2px;
  border: 1px solid rgba(0,0,0,.6);
  background: linear-gradient(180deg, #2e2f34 0%, #222329 100%);
  color: #e9e9ee;
  box-shadow: 0 2px 0 rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
  font: 800 22px/1 "Orbitron", var(--font-ui);
  letter-spacing: .08em;
  cursor: pointer;
}
:root[data-scheme="retro"] .btn.btn-ab-chevron.open,
[data-scheme="retro"] .btn.btn-ab-chevron.open{
  color: #071a12;
  background: linear-gradient(180deg, #1fe0b3 0%, #0fa67f 100%);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);
  box-shadow:
    0 0 14px rgba(6,214,160,.28),
    0 2px 0 rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.35);
}

/* Steps container just inherits grid from inline styles; keep base spacing consistent */
:root[data-scheme="retro"] .row-steps button{
  /* base look for cells (your dynamic inline still sets bg/height/radius) */
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
}

/* Mobile: nearly full width (≈6px gutters) */
@media (max-width: 640px){
  :root[data-scheme="retro"] .step-editor,
  [data-scheme="retro"] .step-editor{
    margin-left: 6px;
    margin-right: 6px;
    max-width: none;  /* allow full stretch */
  }
}

/* =========================
   STEP EDITOR — phone full-bleed + comfy fit
   ========================= */
   @media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse) {
    /* 1) Full-bleed container that ignores parent padding but keeps tiny gutters */
    :root[data-scheme="retro"] .step-editor,
    [data-scheme="retro"] .step-editor{
      /* full-bleed trick */
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      padding-left: max(6px, env(safe-area-inset-left));
      padding-right: max(6px, env(safe-area-inset-right));
      max-width: none;           /* allow full stretch */
      box-sizing: border-box;
    }
  
    /* 2) Ensure the steps area can actually expand on iOS (kill min-width:auto) */
    :root[data-scheme="retro"] .step-editor .row-steps{
      width: 100%;
      min-width: 0 !important;
    }
  
    /* 3) Tighten gaps a touch so more pixels go to the cells */
    :root[data-scheme="retro"] .step-editor .row-steps{
      gap: 6px;                  /* if inline sets a bigger gap, this still helps most UAs */
    }
    :root[data-scheme="retro"] .step-editor .row-steps button{
      min-width: 0;
      /* small visual tighten without changing your dynamic sizing */
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
  
    /* 4) Shrink the header controls just a bit to free width for the grid */
    :root[data-scheme="retro"] .btn.btn-ab,
    [data-scheme="retro"] .btn.btn-ab{
      min-width: 40px;
      height: 38px;
      font-size: 12px;
      letter-spacing: .06em;
    }
    :root[data-scheme="retro"] .btn.btn-ab-chevron,
    [data-scheme="retro"] .btn.btn-ab-chevron{
      min-width: 40px;
      height: 38px;
      font-size: 18px;
    }
  }
  
  /* Ultra-tight phones (≤360px): one more squeeze */
  @media (max-width: 360px) and (any-hover: none) and (any-pointer: coarse){
    :root[data-scheme="retro"] .step-editor .row-steps{ gap: 4px; }
    :root[data-scheme="retro"] .btn.btn-ab,
    [data-scheme="retro"] .btn.btn-ab{ min-width: 36px; height: 36px; font-size: 11px; }
    :root[data-scheme="retro"] .btn.btn-ab-chevron,
    [data-scheme="retro"] .btn.btn-ab-chevron{ min-width: 36px; height: 36px; font-size: 16px; }
  }
  

  /* =========================================
   NARROW LOCK — force the mobile/narrow look on any screen
   ========================================= */
:root[data-scheme="retro"]{
  --page-max: 520px; /* tweak 680–820px to taste */
}

/* 1) CLAMP: everything directly under <body> (with an opt-out) */
[data-scheme="retro"] body > *:not(.retro-full-bleed){
  width: min(100%, var(--page-max)) !important;
  max-width: var(--page-max) !important;
  margin-inline: auto !important;
  box-sizing: border-box;
}

/* 1b) If your app has a named root wrapper, clamp that too (safe no-op if absent) */
[data-scheme="retro"] :where(.gb-root, #app, main){
  width: min(100%, var(--page-max)) !important;
  max-width: var(--page-max) !important;
  margin-inline: auto !important;
}

/* 2) KILL desktop multi-column layouts that make the page feel "wide" */
[data-scheme="retro"] .fx-row.fx-panel.three{ grid-template-columns: 1fr !important; }
[data-scheme="retro"] .sbus-grid{ grid-template-columns: 1fr !important; }

/* 3) Make size scales follow the container, not the viewport */
[data-scheme="retro"] .gb-wordmark{ font-size: clamp(22px, 8.5cqw, 34px) !important; }
[data-scheme="retro"] .channel-block.pads-left{ --pad-size: clamp(49px, 25.5cqw, 136px) !important; }
[data-scheme="retro"] .mode-col{ --mode-btn: clamp(48px, 5cqw, 56px) !important; }
[data-scheme="retro"] .swing-grid-2x2{ --sg-size: clamp(44px, 4.8cqw, 56px) !important; }
[data-scheme="retro"] .swing-grid-inline{ --sg-size: clamp(40px, 4.4cqw, 52px) !important; }

/* 4) Safety: don’t let inner blocks overflow the clamp */
[data-scheme="retro"] :where(.gb-retro-panel, .gb-row, .fx-row, .swing-card, .sbus-card, .transport, .step-editor){
  max-width: 100% !important;
}

/* Optional: add class="retro-full-bleed" to any element that SHOULD remain full width
   (e.g., a decorative banner). */


/* GROOVE — buttons in one horizontal row (keep 3 stacked sections overall) */
:root[data-scheme="retro"] .swing-card.compact .swing-grid-inline{
  display: grid !important;
  grid-auto-flow: column !important;         /* ← one row */
  grid-auto-columns: var(--sg-size, 48px) !important;
  gap: var(--sg-gap, 10px) !important;
  justify-content: start !important;
  align-items: center !important;
  overflow-x: auto !important;               /* scroll if too many buttons */
  scrollbar-width: thin;
}

/* (still stack the sections: buttons row, slider A row, slider B row) */
:root[data-scheme="retro"] .swing-card.compact{
  display: grid !important;
  grid-template-columns: 1fr !important;
  row-gap: 12px !important;
}
:root[data-scheme="retro"] .swing-card.compact :where(.swing-grid-2x2, .swing-inline, .swing-slider-row){
  grid-column: 1 / -1 !important;
}
:root[data-scheme="retro"] .swing-card.compact .swing-slider-row{
  display: grid !important;
  grid-template-columns: 1fr auto !important; /* slider track + LCD */
  align-items: center !important;
}


/* =========================
   HEADER — keep toggles on the right (desktop)
   ========================= */
@media (min-width: 641px){
  :root[data-scheme="retro"] .gb-retro-header{
    display: grid !important;
    grid-template-columns: 1fr auto !important; /* logo grows, toggles size to content */
    align-items: center !important;
    gap: 12px !important;
  }
  :root[data-scheme="retro"] .gb-retro-header > *{ min-width: 0 !important; }
  :root[data-scheme="retro"] .gb-brand{ min-width: 0 !important; }
  :root[data-scheme="retro"] .gb-wordmark{
    justify-self: start !important;
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
  }
  :root[data-scheme="retro"] .gb-theme-switch{
    justify-self: end !important;  /* stays on the right */
    margin: 0 !important;
  }
}

/* Fallback: if some rule forces flex, push the switches to the right */
:root[data-scheme="retro"] .gb-retro-header{ column-gap: 12px; }
:root[data-scheme="retro"] .gb-theme-switch{ margin-left: auto; }

/* RETRO — Step Editor: remove the odd right padding on phones */
@media (max-width: 640px) and (any-hover: none) and (any-pointer: coarse){

  /* Prefer stable viewport units so full-bleed aligns perfectly */
  @supports (width: 1svw){
    [data-scheme="retro"] .step-editor{
      /* full-bleed, but based on the *stable* viewport width */
      margin-left:  calc(50% - 50svw) !important;
      margin-right: calc(50% - 50svw) !important;

      /* tiny, symmetric gutters only */
      padding-left:  max(6px, env(safe-area-inset-left)) !important;
      padding-right: max(6px, env(safe-area-inset-right)) !important;

      /* prevent sub-pixel overflow that looks like padding on the right */
      overflow-x: clip;
      box-sizing: border-box;
    }
  }

  /* Fallback if svw isn't supported: disable full-bleed and keep even gutters */
  @supports not (width: 1svw){
    [data-scheme="retro"] .step-editor{
      margin-left:  6px !important;
      margin-right: 6px !important;
      padding-left:  0 !important;
      padding-right: 0 !important;
      max-width: none !important;
      overflow-x: clip;
    }
  }

  /* Ensure the steps grid doesn't force extra width */
  [data-scheme="retro"] .step-editor .row-steps{
    width: 100%;
    min-width: 0 !important;
    gap: 6px; /* keep your compact spacing */
  }
}
